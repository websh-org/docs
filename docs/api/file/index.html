<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,400i,700,700i&display=swap">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Fira+Sans:400,400i,500,500i,600,600i,700,700i&display=swap&subset=latin-ext">

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/image.css"
    integrity="sha256-F35NJZtdA4AJEz0RQVWT2C3xC1WHMf2Kv/ANYLx0q9w=" crossorigin="anonymous" />
  <link rel="stylesheet" href="/_styles/github.css">
  <link rel="stylesheet" href="/_styles/styles.css">
  
  </link>
  <title>File API</title>
</head>

<body>
  <div id="canvas">
    <header id="header">

    </header>
    <div id="main">
        <div id="content">
            <div id="pane">
        <nav id="nav"><a class="item openable open visible" data-nav-level="0" href=" /">
            WebShell
          </a><a class="item openable visible" data-nav-level="1" href=" /getting-started/">
            Getting Started
          </a><a class="item " data-nav-level="2" href=" /getting-started/sandbox">
            Visit WebShell Sandbox
          </a><a class="item " data-nav-level="2" href=" /getting-started/template-repos">
            App Template Repos
          </a><a class="item openable visible" data-nav-level="1" href=" /app-developer-guide/">
            App Developer&#39;s Guide
          </a><a class="item " data-nav-level="2" href=" /app-developer-guide/works-how">
            How It Works
          </a><a class="item openable" data-nav-level="2" href=" /tutorial/">
            Tutorial
          </a><a class="item " data-nav-level="3" href=" /tutorial/step1">
            Step 1 - Import the library
          </a><a class="item " data-nav-level="3" href=" /tutorial/step2">
            Step 2 - App manifest
          </a><a class="item " data-nav-level="3" href=" /tutorial/step3">
            Step 3 - See it in action
          </a><a class="item " data-nav-level="3" href=" /tutorial/step4">
            Step 4 - Declare file operations
          </a><a class="item " data-nav-level="3" href=" /tutorial/step5">
            Step 5 - Implement file operations
          </a><a class="item " data-nav-level="3" href=" /tutorial/step6">
            Step 6 - Make and publish a real app
          </a><a class="item openable open visible" data-nav-level="1" href=" /api/">
            Docs
          </a><a class="item visible" data-nav-level="2" href=" /api/app-manifest">
            App Manifest
          </a><a class="item openable open visible active" data-nav-level="2" href=" /api/file/">
            File API
          </a><a class="item visible" data-nav-level="3" href=" /api/file/manifest">
            Manifest
          </a><a class="item visible" data-nav-level="3" href=" /api/file/commands">
            Commands
          </a><a class="item openable visible" data-nav-level="1" href=" /packages/">
            Npm Packages
          </a><a class="item " data-nav-level="2" href=" /packages/web-shell-app">
            web-shell-app
          </a><a class="item " data-nav-level="2" href=" /packages/remote-slave-port">
            remote-slave-port
          </a><a class="item " data-nav-level="2" href=" /packages/remote-master-port">
            remote-master-port
          </a><a class="item visible" data-nav-level="1" href=" /about">
            About
          </a></nav>
      </div>
      <aside><nav id="toc">
          <a class="item" data-toc-level="1" href="##">
            File API
          </a><a class="item" data-toc-level="2""  href=" #api-manifest">
            API Manifest
          </a><a class="item" data-toc-level="3""  href=" #file-formats-details">
            File formats details:
          </a><a class="item" data-toc-level="3""  href=" #example">
            Example
          </a><a class="item" data-toc-level="2""  href=" #commands">
            Commands
          </a><a class="item" data-toc-level="3""  href=" #file-new">
            file-new
          </a><a class="item" data-toc-level="4""  href=" #synopsys">
            Synopsys
          </a><a class="item" data-toc-level="4""  href=" #example-1">
            Example
          </a><a class="item" data-toc-level="4""  href=" #workflow">
            Workflow
          </a><a class="item" data-toc-level="3""  href=" #file-open">
            file-open
          </a><a class="item" data-toc-level="4""  href=" #synopsis">
            Synopsis
          </a><a class="item" data-toc-level="4""  href=" #errors">
            Errors
          </a><a class="item" data-toc-level="4""  href=" #example-2">
            Example
          </a><a class="item" data-toc-level="4""  href=" #workflow-1">
            Workflow
          </a><a class="item" data-toc-level="3""  href=" #file-save">
            file-save
          </a><a class="item" data-toc-level="4""  href=" #synopsis-1">
            Synopsis
          </a><a class="item" data-toc-level="4""  href=" #example-3">
            Example
          </a><a class="item" data-toc-level="4""  href=" #workflow-2">
            Workflow
          </a><a class="item" data-toc-level="5""  href=" #save">
            Save
          </a><a class="item" data-toc-level="5""  href=" #save-as">
            Save As
          </a></nav></aside>
        <article class="markdown-body">
          <a name="#"></a><h1>
            File API
          </h1><p>Supports file operations in WebShell apps.</p>
<ul>
<li><em>format</em> is a file format described in the app manifest.</li>
<li><em>document</em> is the current state of the app that can be opened or saved to a file.</li>
<li><em>current file</em> is the file that was opened or created by the app. This is tracked by WebShell, not the app.</li>
</ul>

      <h2>
        <a name="api-manifest" class="anchor" href="#api-manifest">
          <span class="header-link"></span>
        </a>
        API Manifest
      </h2><pre><code class="language-js">{
  ...
  api: {
    <span class="hljs-built_in">Object</span> file: {
      <span class="hljs-built_in">String</span> <span class="hljs-keyword">new</span>,
      <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">String</span>&gt;: open,
      <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">String</span>&gt;: save,
      <span class="hljs-built_in">Object</span> formats: {
        <span class="hljs-string">"format-id"</span>: <span class="hljs-built_in">Object</span> {
          <span class="hljs-built_in">String</span> name, 
          <span class="hljs-built_in">String</span> extension, 
          <span class="hljs-built_in">String</span> type,
          <span class="hljs-built_in">String</span> accept,
          <span class="hljs-built_in">String</span> encoding = <span class="hljs-string">"text"</span>,
        }
      }
    }
  }
}</code></pre>
<ul>
<li><code>new</code> is the id of the &quot;native&quot; file format of the app. It will be used to name new files. It must refer to one of the file formats defined under <code>formats</code>.</li>
<li><code>open</code> is an array of ids of the file formats that the app can open.</li>
<li><code>save</code> is an array of ids of the file formats that the app can save.</li>
</ul>

      <h3>
        <a name="file-formats-details" class="anchor" href="#file-formats-details">
          <span class="header-link"></span>
        </a>
        File formats details:
      </h3><ul>
<li><code>name</code> - The human readable name of this file format.<ul>
<li>Will be used for display in file dialogs and for naming new files.</li>
</ul>
</li>
<li><code>extension</code> - The extension for this file format. <ul>
<li>Will be appended to file names on Save As.</li>
<li>Unless `acceptË™ is satisfied, will be used for filtering files in file dialogs.</li>
</ul>
</li>
<li><code>type</code> - the content type of this format. <ul>
<li>Files of this format will be saved with this type.</li>
</ul>
</li>
<li><code>accept</code> - the filter for this file format in file dialogs. <ul>
<li>Uses the same format as the <code>accept</code> attribute of the HTML file input.</li>
</ul>
</li>
<li><code>encoding</code><ul>
<li>The encoding to be used when transferring this format. The valid values are:<ul>
<li><code>&quot;text&quot;</code> - The content is text and will be transfered as a string.</li>
<li><code>&quot;dataurl&quot;</code> - The content will be transferred as a data url.</li>
<li>Not yet implemented:<ul>
<li><code>&quot;json&quot;</code> - The content is JSON text and will be transfered as any JSONable value.</li>
<li><code>&quot;base64&quot;</code> - The content is binary and will be transfered as a base64-encoded string.</li>
<li><code>&quot;binary&quot;</code> - The content is binary and will be transferred as a <code>UInt8Array</code> buffer.</li>
<li><code>&quot;blob&quot;</code> - The content will be transferred as a blob object.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      <h3>
        <a name="example" class="anchor" href="#example">
          <span class="header-link"></span>
        </a>
        Example
      </h3><pre><code class="language-json">{
  ...
  &quot;api&quot;: {
    &quot;file&quot;: {
      &quot;new&quot;: &quot;text&quot;,
      &quot;open&quot;: [&quot;text&quot;],
      &quot;save&quot;: [&quot;text&quot;],
      &quot;formats&quot;: {
        &quot;text&quot;: {
          &quot;name&quot;: &quot;Text File&quot;,
          &quot;extension&quot;: &quot;txt&quot;,
          &quot;type&quot;: &quot;text/plain&quot;,
          &quot;accept&quot;: &quot;text/*&quot;
        }
      }
    }
  }
}</code></pre>

      <h2>
        <a name="commands" class="anchor" href="#commands">
          <span class="header-link"></span>
        </a>
        Commands
      </h2>
      <h3>
        <a name="file-new" class="anchor" href="#file-new">
          <span class="header-link"></span>
        </a>
        file-new
      </h3><p>Create an empty document.</p>

      <h4>
        <a name="synopsys" class="anchor" href="#synopsys">
          <span class="header-link"></span>
        </a>
        Synopsys
      </h4><pre><code class="language-js">Command <span class="hljs-string">"file-new"</span> {} =&gt; <span class="hljs-literal">true</span></code></pre>

      <h4>
        <a name="example-1" class="anchor" href="#example-1">
          <span class="header-link"></span>
        </a>
        Example
      </h4><pre><code class="language-js">WebShellApp.command( <span class="hljs-string">"file-new"</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ 
  <span class="hljs-keyword">await</span> myEditor.emptyContent();
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
})</code></pre>

      <h4>
        <a name="workflow" class="anchor" href="#workflow">
          <span class="header-link"></span>
        </a>
        Workflow
      </h4><ol>
<li>The user clicks the <strong>File &gt; New</strong> button</li>
<li>WebShell sends the command to the app</li>
<li>The app creates a new empty document</li>
<li>The app returns <code>true</code></li>
<li>WebShell sets the current file in accordance with the manifest<blockquote>
<p>The file is named <code>New [label].[extension]</code></p>
</blockquote>
</li>
</ol>

      <h3>
        <a name="file-open" class="anchor" href="#file-open">
          <span class="header-link"></span>
        </a>
        file-open
      </h3><p>The app receives the content of the file to be opened, as well as its extension and the ID of its format (this will be one of the formats specified in the app&#39;s manifest). The type of <code>content</code> depends on the encoding specified in the format.</p>

      <h4>
        <a name="synopsis" class="anchor" href="#synopsis">
          <span class="header-link"></span>
        </a>
        Synopsis
      </h4><pre><code class="language-js">Command <span class="hljs-string">"file-open"</span> { <span class="hljs-built_in">String</span> extension, <span class="hljs-built_in">String</span> format, Varying content } =&gt; <span class="hljs-literal">true</span></code></pre>

      <h4>
        <a name="errors" class="anchor" href="#errors">
          <span class="header-link"></span>
        </a>
        Errors
      </h4><pre><code class="language-js"><span class="hljs-built_in">Error</span> <span class="hljs-string">"file-cannot-open"</span> { <span class="hljs-built_in">String</span> reason }</code></pre>
<p>Throw if the received content does not match the supplied expected format.</p>

      <h4>
        <a name="example-2" class="anchor" href="#example-2">
          <span class="header-link"></span>
        </a>
        Example
      </h4><pre><code class="language-js">WebShellApp.command(<span class="hljs-string">"file-open"</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">{format, content, extension}</span>) </span>{ 
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> myEditor.setContent(content);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">this</span>.throw(<span class="hljs-string">"file-cannot-open"</span>, { 
      <span class="hljs-attr">reason</span>: <span class="hljs-built_in">String</span>(error) 
    })
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
})</code></pre>

      <h4>
        <a name="workflow-1" class="anchor" href="#workflow-1">
          <span class="header-link"></span>
        </a>
        Workflow
      </h4><ol>
<li>The user clicks the <strong>File &gt; Open</strong> button</li>
<li>WebShell displays the <strong>File Open</strong> dialog to allow the user tp choose a file.</li>
<li>WebShell sends the command to the app</li>
<li>The app creates a new document from the file&#39;s contents.</li>
<li>The app returns <code>true</code><blockquote>
<p>If the app throws an error, WebShell display it and skips the following steps.</p>
</blockquote>
</li>
<li>WebShell sets the current file to the opened file</li>
</ol>

      <h3>
        <a name="file-save" class="anchor" href="#file-save">
          <span class="header-link"></span>
        </a>
        file-save
      </h3><p>The app receives the format and the extension of the file that is to be saved, and returns the content of the file that will be saved. The expected type of <code>content</code> depends on the encoding specified in the manifest. The default mime type specified in the format in the manifest will be used for the saved file.</p>

      <h4>
        <a name="synopsis-1" class="anchor" href="#synopsis-1">
          <span class="header-link"></span>
        </a>
        Synopsis
      </h4><pre><code class="language-js">Command <span class="hljs-string">"file-save"</span> { <span class="hljs-built_in">String</span> extension,  <span class="hljs-built_in">String</span> format } =&gt; { content }</code></pre>

      <h4>
        <a name="example-3" class="anchor" href="#example-3">
          <span class="header-link"></span>
        </a>
        Example
      </h4><pre><code class="language-js">WebShellApp.command(<span class="hljs-string">"file-open"</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">{format, extension}</span>) </span>{ 
  <span class="hljs-keyword">switch</span> (format) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"text"</span>: <span class="hljs-keyword">return</span> ({ 
      <span class="hljs-attr">content</span>: <span class="hljs-keyword">await</span> myEditor.getText() 
    })
    <span class="hljs-keyword">case</span> <span class="hljs-string">"myFormat"</span>: <span class="hljs-keyword">return</span> ({ 
      <span class="hljs-attr">content</span>: <span class="hljs-keyword">await</span> myEditor.getContent() 
    })
  }
})</code></pre>

      <h4>
        <a name="workflow-2" class="anchor" href="#workflow-2">
          <span class="header-link"></span>
        </a>
        Workflow
      </h4>
      <h5>
        <a name="save" class="anchor" href="#save">
          <span class="header-link"></span>
        </a>
        Save
      </h5><ol>
<li>The user clicks the <strong>File &gt; Save</strong></li>
<li>WebShell sends the command to the app, with <code>format</code> and <code>extension</code> set according to the current file.</li>
<li>The app creates the file content from its current document</li>
<li>The app returns the content.</li>
<li>WebShell saves the file.</li>
</ol>

      <h5>
        <a name="save-as" class="anchor" href="#save-as">
          <span class="header-link"></span>
        </a>
        Save As
      </h5><ol>
<li>The user clicks <strong>File &gt; Save As</strong> button</li>
<li>WebShell displays the <strong>File Save As</strong> dialog to allow the user to choose a file name and format.</li>
<li>WebShell sends the command to the app, setting <code>format</code> and <code>extension</code> from the dialog.</li>
<li>The app creates the file content from its current document.</li>
<li>The app returns the content.</li>
<li>WebShell saves the file</li>
<li>WebShell sets the current file to the new file name and format.</li>
</ol>

        </article>
      </div>
    </div>
    <div>
</body>

</html>